<mxfile host="app.diagrams.net" modified="2025-12-01T00:00:00.000Z" agent="Draw.io" version="22.0.0">
  <diagram name="Sequence: Thanh toÃ¡n táº¡o Ä‘Æ¡n hÃ ng" id="seq-thanh-toan">
    <mxGraphModel dx="2400" dy="1600" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2400" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- ==================== TIÃŠU Äá»€ ==================== -->
        <mxCell id="title" value="Biá»ƒu Ä‘á»“ trÃ¬nh tá»±: Thanh toÃ¡n vÃ  Táº¡o Ä‘Æ¡n hÃ ng (COD / VNPay / PayPal)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=22;fontStyle=1;fontColor=#000000" vertex="1" parent="1">
          <mxGeometry x="600" y="30" width="800" height="40" as="geometry" />
        </mxCell>

        <!-- ==================== ACTORS & OBJECTS ==================== -->

        <!-- NgÆ°á»i dÃ¹ng Actor -->
        <mxCell id="actor-user" value="" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="80" y="100" width="40" height="60" as="geometry" />
        </mxCell>
        <mxCell id="label-user" value="NgÆ°á»i dÃ¹ng" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;fontSize=14;fontStyle=1;fontColor=#000000" vertex="1" parent="1">
          <mxGeometry x="45" y="165" width="110" height="25" as="geometry" />
        </mxCell>
        <mxCell id="line-user" value="" style="endArrow=none;dashed=1;dashPattern=8 4;strokeColor=#000000;strokeWidth=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="100" y="190" as="sourcePoint" />
            <mxPoint x="100" y="1850" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- MÃ nHÃ¬nhGiá»HÃ ng -->
        <mxCell id="obj-cart" value=":MÃ nHÃ¬nhGiá»HÃ ng" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=2;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="110" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="line-cart" value="" style="endArrow=none;dashed=1;dashPattern=8 4;strokeColor=#000000;strokeWidth=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="370" y="160" as="sourcePoint" />
            <mxPoint x="370" y="1850" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- MÃ nHÃ¬nhThanhToÃ¡n -->
        <mxCell id="obj-checkout" value=":MÃ nHÃ¬nhThanhToÃ¡n" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=2;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="560" y="110" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="line-checkout" value="" style="endArrow=none;dashed=1;dashPattern=8 4;strokeColor=#000000;strokeWidth=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="650" y="160" as="sourcePoint" />
            <mxPoint x="650" y="1850" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- ApiÄÆ¡nHÃ ng -->
        <mxCell id="obj-api" value=":ApiÄÆ¡nHÃ ng" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=2;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="840" y="110" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="line-api" value="" style="endArrow=none;dashed=1;dashPattern=8 4;strokeColor=#000000;strokeWidth=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="920" y="160" as="sourcePoint" />
            <mxPoint x="920" y="1850" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- taoDonHang.php -->
        <mxCell id="obj-backend" value=":taoDonHang.php" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=2;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1100" y="110" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="line-backend" value="" style="endArrow=none;dashed=1;dashPattern=8 4;strokeColor=#000000;strokeWidth=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1180" y="160" as="sourcePoint" />
            <mxPoint x="1180" y="1850" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- CÆ¡Sá»ŸDá»¯Liá»‡u -->
        <mxCell id="obj-db" value=":CÆ¡Sá»ŸDá»¯Liá»‡u" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=2;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1360" y="110" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="line-db" value="" style="endArrow=none;dashed=1;dashPattern=8 4;strokeColor=#000000;strokeWidth=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1440" y="160" as="sourcePoint" />
            <mxPoint x="1440" y="1850" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- VNPay Gateway -->
        <mxCell id="obj-vnpay" value=":VNPayGateway" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=2;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1620" y="110" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="line-vnpay" value="" style="endArrow=none;dashed=1;dashPattern=8 4;strokeColor=#000000;strokeWidth=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1700" y="160" as="sourcePoint" />
            <mxPoint x="1700" y="1850" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- PayPal Gateway -->
        <mxCell id="obj-paypal" value=":PayPalGateway" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=2;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1880" y="110" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="line-paypal" value="" style="endArrow=none;dashed=1;dashPattern=8 4;strokeColor=#000000;strokeWidth=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1960" y="160" as="sourcePoint" />
            <mxPoint x="1960" y="1850" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- ==================== ACTIVATION BOXES ==================== -->
        <mxCell id="act-user" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="94" y="210" width="12" height="1600" as="geometry" />
        </mxCell>
        <mxCell id="act-cart" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="364" y="230" width="12" height="150" as="geometry" />
        </mxCell>
        <mxCell id="act-checkout" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="644" y="400" width="12" height="1380" as="geometry" />
        </mxCell>

        <!-- ==================== PHáº¦N 1: XEM GIá»Ž HÃ€NG VÃ€ Má»ž THANH TOÃN ==================== -->

        <!-- 1: xem giá» hÃ ng -->
        <mxCell id="m1" value="1: xemGiá»HÃ ng()" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="106" y="250" as="sourcePoint" />
            <mxPoint x="364" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 2: hiá»ƒn thá»‹ giá» hÃ ng -->
        <mxCell id="m2" value="2: hiá»ƒnThá»‹Giá»HÃ ng(danhSÃ¡chSáº£nPháº©m, tá»•ngTiá»n)" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="364" y="300" as="sourcePoint" />
            <mxPoint x="106" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 3: nháº¥n thanh toÃ¡n -->
        <mxCell id="m3" value="3: nháº¥nNÃºtThanhToÃ¡n()" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="106" y="350" as="sourcePoint" />
            <mxPoint x="364" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 4: má»Ÿ mÃ n hÃ¬nh thanh toÃ¡n -->
        <mxCell id="m4" value="4: má»ŸMÃ nHÃ¬nhThanhToÃ¡n(giá»HÃ ng)" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="376" y="410" as="sourcePoint" />
            <mxPoint x="644" y="410" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 5: tÃ­nh tá»•ng tiá»n (self-call) -->
        <mxCell id="m5-line" value="" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="656" y="460" as="sourcePoint" />
            <mxPoint x="700" y="460" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m5-self" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="695" y="460" width="12" height="35" as="geometry" />
        </mxCell>
        <mxCell id="m5-return" value="" style="endArrow=open;endFill=0;dashed=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="695" y="495" as="sourcePoint" />
            <mxPoint x="656" y="495" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m5-label" value="5: tÃ­nhTá»•ngTiá»n()" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontSize=11;fontColor=#000000" vertex="1" parent="1">
          <mxGeometry x="660" y="440" width="130" height="20" as="geometry" />
        </mxCell>

        <!-- 6: hiá»ƒn thá»‹ form thanh toÃ¡n -->
        <mxCell id="m6" value="6: hiá»ƒnThá»‹FormThanhToÃ¡n(tá»•ngTiá»n, phÆ°Æ¡ngThá»©c: COD/VNPay/PayPal)" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="644" y="540" as="sourcePoint" />
            <mxPoint x="106" y="540" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 7: nháº­p Ä‘á»‹a chá»‰ -->
        <mxCell id="m7" value="7: nháº­pÄá»‹aChá»‰GiaoHÃ ng(Ä‘á»‹aChá»‰, sá»‘Äiá»‡nThoáº¡i)" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="106" y="590" as="sourcePoint" />
            <mxPoint x="644" y="590" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 8: chá»n phÆ°Æ¡ng thá»©c -->
        <mxCell id="m8" value="8: chá»nPhÆ°Æ¡ngThá»©cThanhToÃ¡n(phÆ°Æ¡ngThá»©c)" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="106" y="640" as="sourcePoint" />
            <mxPoint x="644" y="640" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 9: xÃ¡c nháº­n Ä‘áº·t hÃ ng -->
        <mxCell id="m9" value="9: xÃ¡cNháº­nÄáº·tHÃ ng()" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="106" y="690" as="sourcePoint" />
            <mxPoint x="644" y="690" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Activation API -->
        <mxCell id="act-api" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="914" y="730" width="12" height="950" as="geometry" />
        </mxCell>

        <!-- 10: gá»i API -->
        <mxCell id="m10" value="10: POST /taoDonHang.php(Ä‘Æ¡nHÃ ng, phÆ°Æ¡ngThá»©c)" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="656" y="740" as="sourcePoint" />
            <mxPoint x="914" y="740" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Activation Backend -->
        <mxCell id="act-backend" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="1174" y="780" width="12" height="850" as="geometry" />
        </mxCell>

        <!-- 11: gá»­i yÃªu cáº§u táº¡o Ä‘Æ¡n -->
        <mxCell id="m11" value="11: gá»­iYÃªuCáº§uTáº¡oÄÆ¡n(dá»¯Liá»‡uÄÆ¡nHÃ ng)" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="926" y="790" as="sourcePoint" />
            <mxPoint x="1174" y="790" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Activation DB -->
        <mxCell id="act-db" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="1434" y="830" width="12" height="180" as="geometry" />
        </mxCell>

        <!-- 12: INSERT Ä‘Æ¡n hÃ ng -->
        <mxCell id="m12" value="12: INSERT INTO donhang(userId, Ä‘á»‹aChá»‰, tá»•ngTiá»n, phÆ°Æ¡ngThá»©c, tráº¡ngThÃ¡i)" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=11;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1186" y="840" as="sourcePoint" />
            <mxPoint x="1434" y="840" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 13: tráº£ vá» mÃ£ Ä‘Æ¡n hÃ ng -->
        <mxCell id="m13" value="13: tráº£Vá»(mÃ£ÄÆ¡nHÃ ng)" style="endArrow=open;endFill=0;dashed=1;strokeColor=#000000;strokeWidth=1;fontSize=11;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1434" y="890" as="sourcePoint" />
            <mxPoint x="1186" y="890" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 14: INSERT chi tiáº¿t Ä‘Æ¡n hÃ ng -->
        <mxCell id="m14" value="14: INSERT INTO chitiet_donhang(mÃ£ÄÆ¡n, mÃ£SP, sá»‘LÆ°á»£ng, giÃ¡)" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=11;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1186" y="940" as="sourcePoint" />
            <mxPoint x="1434" y="940" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 15: tráº£ vá» thÃ nh cÃ´ng -->
        <mxCell id="m15" value="15: tráº£Vá»(thÃ nhCÃ´ng)" style="endArrow=open;endFill=0;dashed=1;strokeColor=#000000;strokeWidth=1;fontSize=11;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1434" y="990" as="sourcePoint" />
            <mxPoint x="1186" y="990" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- ==================== ALT FRAGMENT: CHá»ŒN PHÆ¯Æ NG THá»¨C THANH TOÃN ==================== -->
        <mxCell id="altPayment" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#000000;strokeWidth=2;dashed=0;" vertex="1" parent="1">
          <mxGeometry x="1100" y="1050" width="950" height="540" as="geometry" />
        </mxCell>
        <mxCell id="altPaymentLabel" value="alt" style="text;html=1;strokeColor=#000000;fillColor=#FFFFFF;align=center;verticalAlign=middle;fontSize=12;fontStyle=1;fontColor=#000000" vertex="1" parent="1">
          <mxGeometry x="1100" y="1050" width="40" height="25" as="geometry" />
        </mxCell>

        <!-- ========== NHÃNH 1: COD ========== -->
        <mxCell id="condCOD" value="[phÆ°Æ¡ngThá»©c = COD]" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontSize=13;fontStyle=2;fontColor=#000000" vertex="1" parent="1">
          <mxGeometry x="1150" y="1080" width="200" height="25" as="geometry" />
        </mxCell>

        <!-- 16a: xá»­ lÃ½ COD -->
        <mxCell id="m16a-line" value="" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1186" y="1130" as="sourcePoint" />
            <mxPoint x="1230" y="1130" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m16a-self" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="1225" y="1130" width="12" height="35" as="geometry" />
        </mxCell>
        <mxCell id="m16a-return" value="" style="endArrow=open;endFill=0;dashed=1;strokeColor=#000000;strokeWidth=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1225" y="1165" as="sourcePoint" />
            <mxPoint x="1186" y="1165" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m16a-label" value="16a: Ä‘áº·tTráº¡ngThÃ¡i('Chá» giao hÃ ng')" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontSize=11;fontColor=#000000" vertex="1" parent="1">
          <mxGeometry x="1190" y="1110" width="220" height="20" as="geometry" />
        </mxCell>

        <!-- COD: Cáº­p nháº­t DB -->
        <mxCell id="act-db-cod" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="1434" y="1190" width="12" height="40" as="geometry" />
        </mxCell>
        <mxCell id="m17a" value="17a: UPDATE donhang SET tráº¡ngThÃ¡i='Chá» giao'" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=11;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1186" y="1200" as="sourcePoint" />
            <mxPoint x="1434" y="1200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="m18a" value="18a: tráº£Vá»(thÃ nhCÃ´ng)" style="endArrow=open;endFill=0;dashed=1;strokeColor=#000000;strokeWidth=1;fontSize=11;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1434" y="1225" as="sourcePoint" />
            <mxPoint x="1186" y="1225" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- ========== DIVIDER 1 ========== -->
        <mxCell id="div1" value="" style="endArrow=none;dashed=1;dashPattern=10 5;strokeColor=#000000;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1100" y="1260" as="sourcePoint" />
            <mxPoint x="2050" y="1260" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- ========== NHÃNH 2: VNPAY ========== -->
        <mxCell id="condVNPay" value="[phÆ°Æ¡ngThá»©c = VNPay]" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontSize=13;fontStyle=2;fontColor=#000000" vertex="1" parent="1">
          <mxGeometry x="1150" y="1280" width="200" height="25" as="geometry" />
        </mxCell>

        <!-- Activation VNPay -->
        <mxCell id="act-vnpay" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="1694" y="1320" width="12" height="120" as="geometry" />
        </mxCell>

        <!-- 16b: gá»i VNPay -->
        <mxCell id="m16b" value="16b: táº¡oURLThanhToÃ¡n(mÃ£ÄÆ¡n, sá»‘Tiá»n)" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1186" y="1330" as="sourcePoint" />
            <mxPoint x="1694" y="1330" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 17b: chuyá»ƒn hÆ°á»›ng VNPay -->
        <mxCell id="m17b" value="17b: chuyá»ƒnHÆ°á»›ngNgÆ°á»iDÃ¹ng(vnpayURL)" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1694" y="1370" as="sourcePoint" />
            <mxPoint x="106" y="1370" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 18b: xÃ¡c nháº­n thanh toÃ¡n -->
        <mxCell id="m18b" value="18b: xÃ¡cNháº­nThanhToÃ¡nVNPay()" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="106" y="1410" as="sourcePoint" />
            <mxPoint x="1694" y="1410" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 19b: tráº£ vá» káº¿t quáº£ VNPay -->
        <mxCell id="m19b" value="19b: tráº£Vá»(vnp_ResponseCode, vnp_TransactionNo)" style="endArrow=open;endFill=0;dashed=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1694" y="1440" as="sourcePoint" />
            <mxPoint x="1186" y="1440" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- ========== DIVIDER 2 ========== -->
        <mxCell id="div2" value="" style="endArrow=none;dashed=1;dashPattern=10 5;strokeColor=#000000;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1100" y="1470" as="sourcePoint" />
            <mxPoint x="2050" y="1470" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- ========== NHÃNH 3: PAYPAL ========== -->
        <mxCell id="condPayPal" value="[phÆ°Æ¡ngThá»©c = PayPal]" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontSize=13;fontStyle=2;fontColor=#000000" vertex="1" parent="1">
          <mxGeometry x="1150" y="1490" width="200" height="25" as="geometry" />
        </mxCell>

        <!-- Activation PayPal -->
        <mxCell id="act-paypal" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="1954" y="1520" width="12" height="120" as="geometry" />
        </mxCell>

        <!-- 16c: gá»i PayPal -->
        <mxCell id="m16c" value="16c: createPayPalOrder(mÃ£ÄÆ¡n, sá»‘Tiá»n, currency)" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1186" y="1530" as="sourcePoint" />
            <mxPoint x="1954" y="1530" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 17c: hiá»ƒn thá»‹ PayPal popup -->
        <mxCell id="m17c" value="17c: hiá»ƒnThá»‹PayPalCheckout(approveURL)" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1954" y="1570" as="sourcePoint" />
            <mxPoint x="106" y="1570" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 18c: approve payment -->
        <mxCell id="m18c" value="18c: approvePayPalPayment()" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="106" y="1610" as="sourcePoint" />
            <mxPoint x="1954" y="1610" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 19c: tráº£ vá» káº¿t quáº£ PayPal -->
        <mxCell id="m19c" value="19c: tráº£Vá»(paymentId, payerId, status)" style="endArrow=open;endFill=0;dashed=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1954" y="1640" as="sourcePoint" />
            <mxPoint x="1186" y="1640" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- ==================== Káº¾T THÃšC ALT - PHáº¦N CHUNG ==================== -->

        <!-- 20: tráº£ vá» JSON -->
        <mxCell id="m20" value="20: tráº£Vá»(JSON{mÃ£ÄÆ¡n, tráº¡ngThÃ¡i, thanhToÃ¡n})" style="endArrow=open;endFill=0;dashed=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1174" y="1700" as="sourcePoint" />
            <mxPoint x="926" y="1700" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 21: tráº£ vá» káº¿t quáº£ -->
        <mxCell id="m21" value="21: tráº£Vá»(káº¿tQuáº£Äáº·tHÃ ng)" style="endArrow=open;endFill=0;dashed=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="914" y="1750" as="sourcePoint" />
            <mxPoint x="656" y="1750" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 22: hiá»ƒn thá»‹ thÃ nh cÃ´ng -->
        <mxCell id="m22" value="22: hiá»ƒnThá»‹('Äáº·t hÃ ng thÃ nh cÃ´ng! MÃ£ Ä‘Æ¡n: #xxx')" style="endArrow=block;endFill=1;strokeColor=#000000;strokeWidth=1;fontSize=12;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="644" y="1800" as="sourcePoint" />
            <mxPoint x="106" y="1800" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- ==================== NOTES ==================== -->
        <mxCell id="note1" value="ðŸ“Œ PhÆ°Æ¡ng thá»©c thanh toÃ¡n:&#xa;&#xa;â€¢ COD: Thanh toÃ¡n khi nháº­n hÃ ng&#xa;  â†’ KhÃ´ng cáº§n xÃ¡c nháº­n online&#xa;  â†’ Tráº¡ng thÃ¡i: 'Chá» giao hÃ ng'&#xa;&#xa;â€¢ VNPay: Cá»•ng thanh toÃ¡n VN&#xa;  â†’ Chuyá»ƒn hÆ°á»›ng Ä‘áº¿n VNPay&#xa;  â†’ XÃ¡c nháº­n qua vnp_ResponseCode&#xa;&#xa;â€¢ PayPal: Thanh toÃ¡n quá»‘c táº¿&#xa;  â†’ Hiá»ƒn thá»‹ PayPal popup&#xa;  â†’ XÃ¡c nháº­n qua paymentId" style="shape=note;whiteSpace=wrap;html=1;size=14;verticalAlign=top;align=left;spacingTop=10;spacingLeft=10;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="2100" y="250" width="240" height="240" as="geometry" />
        </mxCell>

        <mxCell id="note2" value="ðŸ“Œ Quy trÃ¬nh táº¡o Ä‘Æ¡n hÃ ng:&#xa;&#xa;1. Xem giá» hÃ ng â†’ Thanh toÃ¡n&#xa;2. Nháº­p Ä‘á»‹a chá»‰ giao hÃ ng&#xa;3. Chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n&#xa;4. XÃ¡c nháº­n Ä‘áº·t hÃ ng&#xa;5. Táº¡o Ä‘Æ¡n + chi tiáº¿t trong DB&#xa;6. Xá»­ lÃ½ thanh toÃ¡n theo PT&#xa;7. Hiá»ƒn thá»‹ káº¿t quáº£" style="shape=note;whiteSpace=wrap;html=1;size=14;verticalAlign=top;align=left;spacingTop=10;spacingLeft=10;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="2100" y="520" width="240" height="180" as="geometry" />
        </mxCell>

        <mxCell id="legend" value="ChÃº thÃ­ch:&#xa;â”â”â–¶ : Gá»i phÆ°Æ¡ng thá»©c (Ä‘á»“ng bá»™)&#xa;- - -â–· : Tráº£ vá» káº¿t quáº£&#xa;[Ä‘iá»u kiá»‡n] : NhÃ¡nh thay tháº¿ (alt)&#xa;&#xa;COD = Cash On Delivery&#xa;VNPay = Cá»•ng thanh toÃ¡n VN&#xa;PayPal = Thanh toÃ¡n quá»‘c táº¿" style="shape=note;whiteSpace=wrap;html=1;size=14;verticalAlign=top;align=left;spacingTop=10;spacingLeft=10;fillColor=#FFFFFF;strokeColor=#000000;strokeWidth=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="2100" y="730" width="240" height="160" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
