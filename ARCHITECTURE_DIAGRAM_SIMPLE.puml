@startuml Kien_Truc_He_Thong_Don_Gian
!theme plain
skinparam backgroundColor #FFFFFF
title S∆° ƒê·ªì Ki·∫øn Tr√∫c H·ªá Th·ªëng ƒê∆°n Gi·∫£n\n·ª®ng D·ª•ng B√°n ƒê·ªìng H·ªì

' Styling
skinparam rectangle {
    BackgroundColor #E8F4F8
    BorderColor #0277BD
    FontSize 12
    FontStyle bold
}

skinparam database {
    BackgroundColor #C8E6C9
    BorderColor #2E7D32
}

skinparam cloud {
    BackgroundColor #FFF9C4
    BorderColor #F57C00
}

' ============================================
' MAIN ARCHITECTURE
' ============================================

rectangle "üì± **CLIENT LAYER**\n//Android Application//" as Client #E3F2FD {
    rectangle "Presentation\n(23 Activities)" as UI
    rectangle "Business Logic\n(9 Adapters)" as Logic
    rectangle "Data Layer\n(Retrofit + PaperDB)" as Data

    UI -down-> Logic
    Logic -down-> Data
}

cloud "üåê **INTERNET**\nHTTP/HTTPS\nREST API" as Network #E1F5FE

rectangle "üñ•Ô∏è **SERVER LAYER**\n//PHP Backend//" as Server #FFF9C4 {
    rectangle "API Endpoints\n(50+ PHP files)" as API
    rectangle "Business Logic\n(Validation, Auth, Security)" as ServerLogic
    rectangle "Database Access\n(MySQLi)" as DBAccess

    API -down-> ServerLogic
    ServerLogic -down-> DBAccess
}

database "üóÑÔ∏è **DATABASE LAYER**\n//MySQL//" as Database #C8E6C9 {
    rectangle "13 Tables" as Tables
    rectangle "3 Triggers" as Triggers

    Tables -[hidden]right- Triggers
}

rectangle "üåç **EXTERNAL SERVICES**" as External #FFCCBC {
    rectangle "VNPay\n(‚úÖ Active)" as VNPay
    rectangle "Firebase\n(‚úÖ Google Auth)" as Firebase
    rectangle "Gmail SMTP\n(‚úÖ OTP Email)" as Gmail

    VNPay -[hidden]right- Firebase
    Firebase -[hidden]right- Gmail
}

' ============================================
' CONNECTIONS
' ============================================

Client <-down-> Network : "JSON\nRequests"
Network <-down-> Server : "API\nCalls"
Server <-down-> Database : "SQL\nQueries"

Server <.right.> External : "Integration"
Client <.up.> External : "Callback"

' ============================================
' NOTES
' ============================================

note right of Client
    **User Interface**
    ‚Ä¢ 15 m√†n h√¨nh User
    ‚Ä¢ 8 m√†n h√¨nh Admin
    ‚Ä¢ Material Design
    ‚Ä¢ Role-based access

    **Local Storage**
    ‚Ä¢ PaperDB (Session)
    ‚Ä¢ Image cache (Glide)
end note

note right of Server
    **8 Module Groups**
    1. Authentication (4 APIs)
    2. Product (7 APIs)
    3. Order (5 APIs)
    4. Payment (9 APIs)
    5. User Mgmt (5 APIs)
    6. Voucher (3 APIs)
    7. Statistics (2 APIs)
    8. Inventory (2 APIs)
end note

note right of Database
    **Core Tables:**
    ‚Ä¢ user (ph√¢n quy·ªÅn)
    ‚Ä¢ sanphammoi (s·∫£n ph·∫©m)
    ‚Ä¢ donhang (ƒë∆°n h√†ng)
    ‚Ä¢ voucher (m√£ gi·∫£m gi√°)

    **Auto Triggers:**
    ‚Ä¢ Gi·∫£m t·ªìn kho
    ‚Ä¢ Ho√†n t·ªìn kho
    ‚Ä¢ Update voucher
end note

note right of External
    **Payment:**
    ‚úÖ VNPay Sandbox
    ‚ö†Ô∏è PayPal (inactive)

    **Auth:**
    ‚úÖ Google Sign-In
    ‚úÖ OTP Email
end note

' ============================================
' DATA FLOW EXAMPLE
' ============================================

note bottom
    **üîÑ LU·ªíNG D·ªÆ LI·ªÜU MUA H√ÄNG:**

    1. User ch·ªçn s·∫£n ph·∫©m ‚Üí GioHangActivity
    2. Checkout ‚Üí ThanhToanActivity
    3. Ch·ªçn VNPay ‚Üí API call vnpay_create_payment.php
    4. Server: T·∫°o ƒë∆°n + Payment URL
    5. App m·ªü WebView VNPay
    6. User thanh to√°n
    7. VNPay callback ‚Üí Deep link
    8. App verify ‚Üí vnpay_check_status.php
    9. Server update tr·∫°ng th√°i ‚Üí Trigger gi·∫£m t·ªìn kho
    10. App hi·ªÉn th·ªã ƒë∆°n h√†ng th√†nh c√¥ng
end note

' ============================================
' LEGEND
' ============================================

legend bottom right
    **TH·ªêNG K√ä D·ª∞ √ÅN:**
    ‚Ä¢ Activities: 23
    ‚Ä¢ API Endpoints: 50+
    ‚Ä¢ Database Tables: 13
    ‚Ä¢ Features: 50+
    ‚Ä¢ Lines of code: ~43,500

    **PH√ÇN QUY·ªÄN:**
    ‚Ä¢ role=0: User th∆∞·ªùng
    ‚Ä¢ role=1: Admin

    **C√îNG NGH·ªÜ:**
    ‚Ä¢ Android (Java) + PHP + MySQL
    ‚Ä¢ Retrofit + RxJava + PaperDB
    ‚Ä¢ VNPay + Firebase + Google Auth
end legend

@enduml

